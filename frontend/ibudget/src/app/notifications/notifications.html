<app-toggleable-sidebar/>
<app-header></app-header>

<main class="notifications-container">
  <div class="notifications-header">
    <button class="btn-mark-all" (click)="markAllAsRead()">
      <i class="fas fa-check-double"></i>
        Mark all as read
    </button>
    <div class="notifications-stats">
      <span>Showing {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ Math.min(currentPage * itemsPerPage, notifications.length) }} of {{ notifications.length }}</span>
    </div>
  </div>

  <div class="notifications-content">
    <div class="notifications-list">
      @for (notification of paginatedNotifications; track notification.id) {
        <div
          class="notification-item"
          [class.unread]="!notification.read"
          [ngClass]="notificationService.getNotificationColor(notification.type, notification.urgency)">
          
          <div class="notification-icon">
            <i [ngClass]="notificationService.getNotificationIcon(notification.type)"></i>
          </div>
          
          <div class="notification-content">
            <h3 class="notification-title">{{ notification.title }}</h3>
            <span class="notification-date">{{ notification.date }}</span>

            <div class="notification-meta">
              @if (notification.category) {
                <div class="notification-category">
                  <span class="category-tag">{{ notification.category }}</span>
                </div>
              }

              @if (notification.amount) {
                <div class="notification-amount">
                  <i class="fas fa-money-bill-wave"></i>
                  {{ notification.amount | currency:'PHP' }}
                </div>
              }
            </div>

            <p class="notification-message">{{ notification.message }}</p>
          </div>
          
          <div class="notification-actions">
            @if (!notification.read) {
              <button 
                class="btn-mark-read"
                (click)="markAsRead(notification)"
                title="Mark as read">
                <i class="fas fa-check"></i>
              </button>
            }
            
            @if (notification.type === 'SAVINGS_COMPLETED' || 
                 notification.type === 'SAVINGS_MILESTONE_50' || 
                 notification.type === 'SAVINGS_MILESTONE_75') {
              <button 
                class="btn-view-details"
                (click)="viewDetails(notification.referenceId!)"
                title="View details">
                <i class="fas fa-eye"></i>
              </button>
            }
            
            <button 
              class="btn-delete"
              (click)="deleteNotification(notification.id)"
              title="Delete notification">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      }
      
      @if (notifications.length === 0) {
        <div class="no-notifications">
          <i class="fas fa-bell-slash"></i>
          <h3>No notifications</h3>
          <p>You're all caught up! New notifications will appear here.</p>
        </div>
      }
    </div>

    <!-- Pagination Controls -->
    @if (notifications.length > itemsPerPage) {
      <div class="pagination">
        <button 
          class="pagination-btn"
          [disabled]="currentPage === 1"
          (click)="previousPage()">
          <i class="fas fa-chevron-left"></i>
          Previous
        </button>

        <div class="pagination-numbers">
          @if (visiblePageNumbers[0] > 1) {
            <button class="pagination-number" (click)="goToPage(1)">1</button>
            @if (visiblePageNumbers[0] > 2) {
              <span class="pagination-ellipsis">...</span>
            }
          }

          @for (page of visiblePageNumbers; track page) {
            <button 
              class="pagination-number"
              [class.active]="page === currentPage"
              (click)="goToPage(page)">
              {{ page }}
            </button>
          }

          @if (visiblePageNumbers[visiblePageNumbers.length - 1] < totalPages) {
            @if (visiblePageNumbers[visiblePageNumbers.length - 1] < totalPages - 1) {
              <span class="pagination-ellipsis">...</span>
            }
            <button class="pagination-number" (click)="goToPage(totalPages)">{{ totalPages }}</button>
          }
        </div>

        <button 
          class="pagination-btn"
          [disabled]="currentPage === totalPages"
          (click)="nextPage()">
          Next
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    }
  </div>
</main>