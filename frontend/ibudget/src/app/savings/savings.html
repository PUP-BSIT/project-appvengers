<app-header/>
<app-toggleable-sidebar/>

<main>
  <div class="inner-wrapper">
    <div class="actions-container">
      <!-- <div>
        <h3>Savings</h3>
        <p class="text-secondary">
          Manage your savings goals and track your progress.
        </p>
      </div> -->

      <div>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Search savings name" 
          [ngModel]="searchQuery()"
          (ngModelChange)="searchQuery.set($event)"/>
      </div>

      <div>
        <button 
          class="btn btn-primary"
          routerLink="/savings/add-saving">
            <i class="bi bi-plus-circle-fill"></i>
            Add New Saving
        </button>
      </div>
    </div>
    
    <div class="savings-container">
      @if(isLoading()) {
        <div class="loading-spinner-container">
          <div class="spinner-border text-primary" role="status"></div>
        </div>
      } @else if(filteredSavings().length === 0) {
        <div class="no-savings-ui">
          <div class="no-savings-icon-wrapper">
            <i class="bi bi-piggy-bank no-savings-icon"></i>
          </div>
          <div class="no-savings-text">
            <h3>No Savings Goals Yet</h3>
            <p>Start your savings journey!</p>
          </div>
        </div>
      }
      
      @for(saving of paginatedSavings(); track saving.saving_id) {
        <div class="card m-2">
          <div class="card-header bg-dark text-white">
            <h5 class="card-title">{{ saving.name }}</h5>
          </div>

          <div class="card-body">
            <p class="card-text">
              {{ saving.description || 'No description available.' }}
            </p>

            <div class="progress-information">
              <label>Progress</label>
              <h6>{{ getProgressPercentage(saving) }}%</h6>
            </div>

            <div class="saving-progress-container">
              <app-saving-progress 
                [progressPercentage]="getProgressPercentage(saving)"/>
            </div>

            <div class="progress-information  mt-2">
              <p>&#8369; {{ saving.current_amount | number:'1.0-0' }}</p>
              <p>&#8369; {{ saving.target_amount | number:'1.0-0' }}</p>
            </div>

            <div class="progress-information">
              <label>Goal Date</label>
              <h6>{{ saving.goal_date | date: 'MMM d, y' }}</h6>
            </div>
          </div>

          <div class="card-footer d-flex bg-white p-3">
            <button 
              class="btn btn-primary w-100"
              [routerLink]="'/savings/view-saving/' + saving.saving_id">
                View Details
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Pagination -->
    @if(totalPages() > 1) {
      <nav
        aria-label="Savings pagination"
        class="d-flex justify-content-center mt-3">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPage() === 1">
              <button
                class="page-link"
                (click)="prevPage()"
                aria-label="Previous"
                [attr.tabindex]="currentPage() === 1 ? -1 : 0">&laquo;
              </button>
            </li>
            @for(page of getPageNumbers(); track page) {
              <li class="page-item" [class.active]="currentPage() === page">
                <button
                  class="page-link"
                  (click)="goToPage(page)">{{ page }}
                </button>
              </li>
            }
            <li
              class="page-item"
              [class.disabled]="currentPage() === totalPages()">
                <button
                  class="page-link"
                  (click)="nextPage()"
                  aria-label="Next"
                  [attr.tabindex]="currentPage() === totalPages()
                    ? -1 : 0">&raquo;
                </button>
            </li>
            <li class="page-item ms-2 d-flex align-items-center">
              <span class="mx-2">Page</span>
              <input
                type="number"
                class="form-control form-control-sm"
                style="width: 80px;"
                [value]="currentPage()"
                (change)="updateCurrentPage($event)"
                min="1" [attr.max]="totalPages()" />
              <span class="mx-2">of {{ totalPages() }}</span>
            </li>
          </ul>
      </nav>
    }

    <!-- Toast -->
    <div class="toast-container">
      <div #savingsToast 
          class="toast align-items-center border-0">
        <div class="d-flex justify-content-between">
          <div class="toast-body d-flex align-items-center" role="alert">
            <i 
              class="fas fa-check-circle" 
              [ngClass]="{ 
              'fas fa-check-circle': toastType() === 'success', 
              'bi bi-x-circle-fill': toastType() === 'error' }"></i>
            <span>{{ toastMessage() }}</span>
          </div>

          <button 
            type="button" 
            class="btn-close btn-close-white me-2 m-auto" 
            data-bs-dismiss="toast" 
            aria-label="Close">
          </button>
        </div>
      </div>
    </div>
  </div>
</main>