<div class="budget-container">
  <div class="budget-info-container">
    <div class="budget-list-title">
      <h3>Budgets</h3>
      <span class="text-secondary">Smart Spending Starts Here!</span>
    </div>

    <div class="d-flex justify-content-end">
      <app-add-budget-button 
        (addedBudget)="onBudgetAdded($event)"
        [mockBudgetId]="budgets().length + 1"/>
    </div>
  </div>

  <div class="budget-cards-container">
    <div class="card budget-card">
      <div class="card-body">
        <div class="category-info-container">
          <label class="mb-0"> Total Budgets </label>
          <span class="text-black mb-0">
            &#8369; {{ totalBudgetsAmount() | number:'1.0-0': 'en-US' }}
          </span>

          <label>
            {{ getBudgetsCount() }} active budgets
          </label>
        </div>
      </div>
    </div>

    <div class="card budget-card">
      <div class="card-body">
        <div class="category-info-container">
          <label class="mb-0 text-secondary"> Total Spent </label>
          <span class="mb-0">
            &#8369; {{ totalSpentAmount() | number:'1.0-0': 'en-US' }}
          </span>
        </div>
      </div>
    </div>

    <div class="card budget-card">
      <div class="card-body">
        <div class="category-info-container">
          <label class="mb-0 text-secondary"> Remaining </label>
          <span class="mb-0 text-success">
            &#8369; 
            {{ totalBudgetsAmount() - 
                totalSpentAmount() | number:'1.0-0': 'en-US' }}
          </span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="budget-list-container">
    @if(!budgets().length) {
      <span>No budgets available.</span>
    }

    @for(budget of budgets(); track $index) {
      <div class="card budget-card b-card-height mb-2">
        <div class="card-body budget-card-body">
          <div class="budget-card-header">
            <div class="category-info-container-budget-list">
              <label class="mb-0 text-black"> {{ budget.category_name }} </label>
              <span class="text-secondary">
                From {{ budget.start_date | date: 'MMM d, y' }} to
                {{ budget.end_date | date: 'MMM d, y' }}
              </span>
            </div>

            <div class="update-btn-container">
              <app-update-budget-button 
                (updatedBudgetResponse)="onBudgetUpdated($event)"
                (deletedBudgetResponse)="onBudgetDeleted($event)"
                [budgetId]="budget.id"/>
            </div>
          </div>

          <div class="budget-card-body">
            <div class="amount-container">
              <div class="spent-amount">
                <span>
                  &#8369; {{ budget.current_amount | number:'1.0-0': 'en-US' }} 
                </span>

                <span class="text-secondary mb-0">
                  of &#8369; {{ budget.limit_amount | number:'1.0-0': 'en-US' }}
                </span>
              </div>

              <div class="progress-percentage">
                <span class="text-success">
                  {{
                    getBudgetPercent(budget) 
                  }}% Spent
                </span>
              </div>
            </div>
            
            <div class="budget-progress-bar-container">
              <app-budget-progress-bar 
                [progressPercentage]="getBudgetPercent(budget)"/>
            </div>

            <div class="remaining-amount">
              <span>
                &#8369; {{
                  ((budget.limit_amount) - (budget.current_amount ?? 0))
                    | number:'1.0-0':'en-US'
                }} remaining
              </span>
            </div>
          </div>

          <div class="budget-card-action">
            <button
            type="button"
            class="btn btn-primary"
            (click)="viewBudgetDetails(budget.id)">
              View Budget
            </button>
          </div>
        </div>
      </div>
    }
  </div>
</div>