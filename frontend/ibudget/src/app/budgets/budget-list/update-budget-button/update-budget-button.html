<div 
  #updateBudgetModal
  class="modal fade update-budget-modal" 
  data-bs-backdrop="static" 
  data-bs-keyboard="false" 
  tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">
            Update Budget
          </h1>
          <button 
            type="button" 
            class="btn-close"
            (click)="closeModal()"></button>
        </div>

        <div class="modal-body">
          <form [formGroup]="budgetForm">
            <!-- <input type="hidden" formControlName="category_id"/> -->

            <label for="category_id">Category</label>
            <select 
              formControlName="category_id" 
              id="category_id"
              class="form-select mb-3 pointer-events-none"
              title="Category cannot be changed once set"
              [class.is-invalid]="isInvalid('category_id')">
                <!-- <option selected disabled>-- Select Category --</option> -->
                @for(category of categories(); track $index) {
                  <option [value]="category.id">{{ category.name }}</option>
                }
            </select>
            
            <!--Validator Indicator for Catergory-->
            @if (isInvalid('category_id')) {
              <div class="invalid-feedback mb-3">
                Category is required.
              </div>
            }

            <label for="name">Budget Name</label>
            <input
              formControlName="name"
              class="form-control mb-3"
              id="name"
              type="text"
              placeholder="Enter budget name"
              [class.is-invalid]="isInvalid('name')"
            />

            <!-- Validator Indicator for Name -->
            @if(isInvalid('name')) {
              <div class="text-danger mb-2">Budget name is required.</div>
            }

            <label for="limit_amount">Set Budget</label>
            <div class="input-group mb-3">
              <span class="input-group-text fw-bold">&#8369;</span>
              <input 
                formControlName="limit_amount"
                class="form-control"
                id="limit_amount"
                type="number" 
                min="1"
                [class.is-invalid]="isInvalid('limit_amount')"/>
            </div>
            
            <!--Validator Indicator for Budget-->
            @if(isInvalid('limit_amount')) {
              @if(budgetForm.get('limit_amount')?.errors?.['required']) {
                <div class="text-danger mb-2">
                  Budget is required.
                </div>
              } @else if(budgetForm.get('limit_amount')?.errors?.['min']) {
                <div class="text-danger mb-2">
                  Budget is required and must be greater than 0.
                </div>
              }
            }

            <label for="start_date">Start Date</label>
            <input 
              formControlName="start_date"
              class="form-control mb-3"
              id="start_date"
              type="date"
              [class.is-invalid]="isInvalid('start_date')"/>

            <!--Validator Indicator for Start Date-->
            @if(isInvalid('start_date')) {
              <div class="text-danger mb-2">Start Date is required.</div>
            }

            <label for="end_date">End Date</label>
            <input 
              formControlName="end_date"
              class="form-control mb-3"
              id="end_date"
              type="date"
              [class.is-invalid]="isInvalid('end_date')"/>
          </form>

            <!--Validator Indicator for End Date-->
            @if(isInvalid('end_date')) {
              <div class="text-danger mb-2">End Date is required.</div>
            }

          <!-- <div class="kpi-panel-container">
            <app-kpi-panel/>
          </div> -->
        </div>

        <div class="modal-footer">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="closeModal()">
              Close
          </button>
          <button 
            (click)="updateBudget()"
            type="button" 
            class="btn btn-primary">Update</button>
        </div>
      </div>
    </div>
</div>

<!-- Kebab menu -->
<div class="dropdown">
  <button 
    #openUpdateBudgetModalBtn
    class="btn btn-light btn-icon"
    type="button"
    data-bs-toggle="dropdown">
      <ng-icon name="bootstrapThreeDotsVertical"></ng-icon>
  </button>

  <ul class="dropdown-menu dropdown-menu-end">
    <li>
      <button class="dropdown-item" type="button" (click)="onView()">
        View
      </button>
    </li>
    <li>
      <button class="dropdown-item" type="button" (click)="onEdit()">
        Edit
      </button>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <button class="dropdown-item text-danger" type="button" (click)="onDelete()">
        Delete
      </button>
    </li>
  </ul>
</div>

<!-- Snackbar -->
@if (showNotification()) {
  <div class="snackbar" [class.hide]="isHidingNotification()">
    <i class="fas fa-check-circle"></i>
    <span>{{ notificationMessage() }}</span>
  </div>
}

<!-- Confirm Delete Modal -->
<div 
  #confirmDeleteModal 
  class="modal fade" 
  tabindex="-1" 
  data-bs-backdrop="static"
  data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this budget?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>