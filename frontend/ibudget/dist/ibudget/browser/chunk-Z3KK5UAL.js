import{a as N}from"./chunk-55CSL7AI.js";import{a as ae,b}from"./chunk-I2VHBQM2.js";import{d as ie,e as oe}from"./chunk-6ODX6TS2.js";import{a as O}from"./chunk-HPCBQTSM.js";import"./chunk-NYHJAWNZ.js";import{a as G,b as D,c as j,d as $,g as W,i as Y,j as J,k as K,l as X,m as Z,q as ee,s as te}from"./chunk-R4J5TFSL.js";import"./chunk-H4HKKKHV.js";import{h as H,z as B}from"./chunk-OQ6H4KVU.js";import{$a as h,Cb as M,Fb as p,Gb as u,Ib as w,Jb as P,Kb as E,La as s,Nb as C,Ob as Q,Pb as d,Qb as T,Rb as x,U as y,Z as l,Zb as q,_ as c,ha as f,nb as _,nc as z,ob as v,pb as R,rb as F,sb as I,tb as k,ub as o,vb as a,wb as g}from"./chunk-DFJZCQ6A.js";import{a as L,b as U}from"./chunk-DAQOROHW.js";var se=["addCategoryModal"];function le(n,e){n&1&&(o(0,"div",11),d(1," Name is required (min 4 characters). "),a())}function ce(n,e){n&1&&(o(0,"div",11),d(1,"Type is required."),a())}function me(n,e){if(n&1&&(o(0,"div",20),g(1,"i",21),o(2,"span"),d(3),a()()),n&2){let t=u();C("hide",t.isHidingNotification()),s(3),T(t.notificationMessage())}}var S=class n{addCategoryModal;categoryToEdit;existingCategories=[];categoryUpdated=z();formBuilder=y(ee);categoryForm;categoryAdded=z();categoriesService=y(N);toastService=y(O);showNotification=f(!1);isHidingNotification=f(!1);notificationMessage=f("");constructor(){this.categoryForm=this.formBuilder.group({name:["",{validators:[D.required,D.minLength(4)]}],type:["expense",{validators:[D.required]}]})}isInvalid(e){let t=this.categoryForm.get(e);return!!t&&t.invalid&&t.touched}openModal(e){let t=new b(this.addCategoryModal.nativeElement,{backdrop:"static",keyboard:!1});e?(this.categoryForm.patchValue({name:e.name,type:e.type}),this.categoryToEdit=e):(this.categoryForm.reset({type:"expense"}),this.categoryToEdit=void 0),t.show()}openModalWithParams(e){let t="expense";if(e.type){let r=e.type.toLowerCase();(r==="income"||r==="expense")&&(t=r)}this.categoryForm.patchValue({name:e.name||"",type:t}),new b(this.addCategoryModal.nativeElement,{backdrop:"static",keyboard:!1}).show(),(e.name||e.type)&&this.toastService.info("Bonzi Pre-fill","Please review the form carefully before submitting.")}closeModal(){b.getInstance(this.addCategoryModal.nativeElement)?.hide(),this.categoryForm.reset({type:"expense"}),this.categoryToEdit=void 0}saveCategory(){if(this.categoryForm.invalid){this.categoryForm.markAllAsTouched();return}let e=this.categoryForm.value;if(this.existingCategories.some(i=>i.name.toLowerCase()===e.name.trim().toLowerCase()&&i.type===e.type&&(!this.categoryToEdit||i.id!==this.categoryToEdit.id))){this.showNotificationMessage("Category already exists!");return}if(this.categoryToEdit){let i=U(L({},this.categoryToEdit),{name:e.name,type:e.type});this.categoriesService.updateCategory(i).subscribe({next:r=>{this.categoryUpdated.emit(r),this.showNotificationMessage("Category updated successfully!"),this.closeModal()},error:()=>{this.showNotificationMessage("Error updating category. Please try again.")}})}else this.categoriesService.addCategory(e).subscribe({next:i=>{this.categoryAdded.emit(i),this.showNotificationMessage("Category added successfully!"),this.closeModal()},error:()=>{this.showNotificationMessage("Error adding category. Please try again.")}})}showNotificationMessage(e){this.notificationMessage.set(e),this.showNotification.set(!0),this.isHidingNotification.set(!1),setTimeout(()=>{this.isHidingNotification.set(!0),setTimeout(()=>{this.showNotification.set(!1),this.isHidingNotification.set(!1)},300)},3e3)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=h({type:n,selectors:[["app-add-category-modal"]],viewQuery:function(t,i){if(t&1&&w(se,5),t&2){let r;P(r=E())&&(i.addCategoryModal=r.first)}},inputs:{categoryToEdit:"categoryToEdit",existingCategories:"existingCategories"},outputs:{categoryUpdated:"categoryUpdated",categoryAdded:"categoryAdded"},decls:28,vars:10,consts:[["addCategoryModal",""],["tabindex","-1","data-bs-backdrop","static","data-bs-keyboard","false","aria-labelledby","addCategoryModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup"],["for","name"],["id","name","formControlName","name","placeholder","Category name",1,"form-control","mb-2"],[1,"text-danger","mb-2"],["for","type"],["id","type","formControlName","type",1,"form-select","mb-2"],["value","expense"],["value","income"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"snackbar",3,"hide"],[1,"snackbar"],[1,"fas","fa-check-circle"]],template:function(t,i){if(t&1){let r=M();o(0,"div",1,0)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),d(6),a(),o(7,"button",6),p("click",function(){return l(r),c(i.closeModal())}),a()(),o(8,"div",7)(9,"form",8)(10,"label",9),d(11,"Category Name"),a(),g(12,"input",10),_(13,le,2,0,"div",11),o(14,"label",12),d(15,"Type"),a(),o(16,"select",13)(17,"option",14),d(18,"Expense"),a(),o(19,"option",15),d(20,"Income"),a()(),_(21,ce,2,0,"div",11),a()(),o(22,"div",16)(23,"button",17),p("click",function(){return l(r),c(i.closeModal())}),d(24," Close "),a(),o(25,"button",18),p("click",function(){return l(r),c(i.saveCategory())}),d(26),a()()()()(),_(27,me,4,3,"div",19)}t&2&&(s(6),x(" ",i.categoryToEdit?"Edit Category":"Add Category"," "),s(3),k("formGroup",i.categoryForm),s(3),C("is-invalid",i.isInvalid("name")),s(),v(i.isInvalid("name")?13:-1),s(3),C("is-invalid",i.isInvalid("type")),s(5),v(i.isInvalid("type")?21:-1),s(5),x(" ",i.categoryToEdit?"Update Category":"Add Category"," "),s(),v(i.showNotification()?27:-1))},dependencies:[te,W,X,Z,G,K,j,$,Y,J],styles:[".snackbar[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;background:#fff;color:#333;padding:1rem 1.5rem;border-radius:4px;box-shadow:0 3px 10px #0000004d;display:flex;align-items:center;gap:.75rem;z-index:999999!important;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.snackbar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#4caf50;font-size:1.2rem}.snackbar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500}button[_ngcontent-%COMP%]:disabled{pointer-events:none;opacity:.5}.snackbar.hide[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideOut .3s ease-in forwards}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_slideOut{0%{transform:translate(0);opacity:1}to{transform:translate(100%);opacity:0}}"]})};var ge=["confirmDeleteModal"],pe=()=>[1,2,3,4,5,6,7],fe=(n,e)=>e.id;function ye(n,e){n&1&&(o(0,"div",21)(1,"div",22)(2,"div",23),g(3,"div",24)(4,"div",25),a()()())}function ue(n,e){n&1&&F(0,ye,5,0,"div",21,R),n&2&&I(q(0,pe))}function Ce(n,e){if(n&1&&(o(0,"div",9),g(1,"i",26),o(2,"p"),d(3),a()()),n&2){let t=u();s(3),x("No categories found for ",t.activeTab(),".")}}function be(n,e){if(n&1){let t=M();o(0,"div",21)(1,"div",22)(2,"div",27)(3,"button",28),g(4,"i",29),a(),o(5,"ul",30)(6,"li")(7,"button",31),p("click",function(){let r=l(t).$implicit,m=u(2);return c(m.onEditCategory(r))}),d(8," Edit "),a()(),o(9,"li")(10,"button",32),p("click",function(){let r=l(t).$implicit,m=u(2);return c(m.openConfirmDeleteModal(r))}),d(11," Delete "),a()()()(),o(12,"div",33)(13,"div",34),g(14,"i"),a(),o(15,"div")(16,"h5",35),d(17),a(),o(18,"p",36),d(19),a()()()()()}if(n&2){let t=e.$implicit,i=u(2);s(14),Q(i.getIcon(t)),s(3),T(t.name),s(2),x(" Used in ",t.referencesCount||0," transaction/s ")}}function he(n,e){if(n&1&&F(0,be,20,4,"div",21,fe),n&2){let t=u();I(t.filteredCategories())}}var V=class n{addCategoryModalComponent;confirmDeleteModal;categoriesService=y(N);route=y(B);activeTab=f("expense");allCategories=f([]);filteredCategories=f([]);toastService=y(O);isLoading=f(!0);categoryToDelete;timers=[];ngOnInit(){this.loadCategories(),this.route.queryParams.subscribe(e=>{if(e.openModal==="true"||e.name||e.type){let t=setTimeout(()=>{this.addCategoryModalComponent.openModalWithParams(e)},100);this.timers.push(t)}})}ngOnDestroy(){this.timers.forEach(e=>clearTimeout(e)),this.timers=[]}loadCategories(){this.categoriesService.getCategories().subscribe({next:e=>{this.allCategories.set(e),this.filterCategories(),this.initDropdowns(),this.isLoading.set(!1)},error:e=>{console.error("Failed to load categories:",e),this.toastService.error("Load Failed","Failed to load categories. Please try again."),this.isLoading.set(!1)}})}setTab(e){this.activeTab.set(e),this.filterCategories(),this.initDropdowns()}filterCategories(){let e=this.activeTab(),t=this.allCategories().filter(i=>i.type?.toLowerCase()===e);this.filteredCategories.set(t)}initDropdowns(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(t=>new ae(t))}getIcon(e){return{Bills:"fas fa-file-invoice",Bonus:"fas fa-gift",Food:"fas fa-utensils",Shopping:"fas fa-shopping-bag",Salary:"fas fa-briefcase",Transport:"fas fa-bus",Income:"fas fa-wallet",Investments:"fas fa-chart-line",Housing:"fas fa-home",Healthcare:"fas fa-heartbeat",Entertainment:"fas fa-film",Utilities:"fas fa-lightbulb"}[e.name]||"fas fa-tag"}onCategoryAdded(e){this.allCategories.set([...this.allCategories(),e]),this.filterCategories(),this.initDropdowns()}onEditCategory(e){if(e.referencesCount>0){this.toastService.error("Edit Failed","Category is used and cannot be edited.");return}this.addCategoryModalComponent.openModal(e)}onCategoryUpdated(e){let t=this.allCategories().map(i=>i.id===e.id?e:i);this.allCategories.set(t),this.filterCategories(),this.initDropdowns()}openConfirmDeleteModal(e){if(e.referencesCount>0){this.toastService.error("Delete Failed","Category is used and cannot be deleted.");return}this.categoryToDelete=e,new b(this.confirmDeleteModal.nativeElement).show()}confirmDeleteCategory(){this.categoryToDelete&&this.categoriesService.deleteCategory(this.categoryToDelete.id).subscribe({next:()=>{this.toastService.success("Delete Success","Category deleted successfully!");let e=this.allCategories().filter(i=>i.id!==this.categoryToDelete?.id);this.allCategories.set(e),this.filterCategories(),this.initDropdowns(),b.getInstance(this.confirmDeleteModal.nativeElement)?.hide(),this.categoryToDelete=void 0},error:()=>{this.toastService.error("Delete Failed","Error deleting category.")}})}openAddCategoryModal(){this.addCategoryModalComponent.openModal()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=h({type:n,selectors:[["app-categories-panel"]],viewQuery:function(t,i){if(t&1&&(w(S,5),w(ge,5)),t&2){let r;P(r=E())&&(i.addCategoryModalComponent=r.first),P(r=E())&&(i.confirmDeleteModal=r.first)}},decls:37,vars:7,consts:[["confirmDeleteModal",""],[1,"categories-panel-container"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"fw-bold"],[1,"btn","btn-primary","btn-sm","btn-add-cat",3,"click"],[1,"nav","nav-tabs","mb-3"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"row","g-3"],[1,"text-center","text-muted","mt-5"],[3,"categoryAdded","categoryUpdated","existingCategories"],["tabindex","-1","data-bs-backdrop","static","data-bs-keyboard","false",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close"],[1,"modal-body"],[1,"modal-footer"],["data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"btn","btn-danger",3,"click"],[1,"col-12","col-sm-6","col-md-4","col-lg-3"],[1,"card","category-card","shadow-sm","h-100","position-relative"],[1,"card-body"],[1,"placeholder","col-12","placeholder-style-sm","mb-2"],[1,"placeholder","col-8","placeholder-style-sm"],[1,"fas","fa-folder-open","fa-2x","mb-2"],[1,"dropdown","position-absolute","top-0","end-0","m-2"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-sm"],[1,"fas","fa-ellipsis-v"],[1,"dropdown-menu","dropdown-menu-end"],["type","button",1,"dropdown-item",3,"click"],["type","button",1,"dropdown-item","text-danger",3,"click"],[1,"card-body","d-flex","align-items-center","gap-3"],[1,"icon-wrapper"],[1,"mb-1","fw-semibold"],[1,"text-muted","small","mb-0"]],template:function(t,i){if(t&1){let r=M();o(0,"div",1)(1,"div",2)(2,"h2",3),d(3,"Manage Categories"),a(),o(4,"button",4),p("click",function(){return l(r),c(i.openAddCategoryModal())}),d(5," + Add Category "),a()(),o(6,"ul",5)(7,"li",6)(8,"button",7),p("click",function(){return l(r),c(i.setTab("expense"))}),d(9," Expense "),a()(),o(10,"li",6)(11,"button",7),p("click",function(){return l(r),c(i.setTab("income"))}),d(12," Income "),a()()(),o(13,"div",8),_(14,ue,2,1)(15,Ce,4,1,"div",9)(16,he,2,0),a()(),o(17,"app-add-category-modal",10),p("categoryAdded",function(A){return l(r),c(i.onCategoryAdded(A))})("categoryUpdated",function(A){return l(r),c(i.onCategoryUpdated(A))}),a(),o(18,"div",11,0)(20,"div",12)(21,"div",13)(22,"div",14)(23,"h5",15),d(24,"Confirm Delete"),a(),g(25,"button",16),a(),o(26,"div",17)(27,"p"),d(28," Are you sure you want to delete the category "),o(29,"strong"),d(30),a(),d(31,"? "),a()(),o(32,"div",18)(33,"button",19),d(34," Cancel "),a(),o(35,"button",20),p("click",function(){return l(r),c(i.confirmDeleteCategory())}),d(36," Delete "),a()()()()()}t&2&&(s(8),C("active",i.activeTab()==="expense"),s(3),C("active",i.activeTab()==="income"),s(3),v(i.isLoading()?14:i.filteredCategories().length===0?15:16),s(3),k("existingCategories",i.allCategories()),s(13),T(i.categoryToDelete==null?null:i.categoryToDelete.name))},dependencies:[H,S],styles:[".dropdown-menu[_ngcontent-%COMP%]{min-width:3rem;right:0;left:auto;top:1.2rem;position:absolute;border-radius:.5rem;padding:.1rem 0;background:#fff;border:1.5px solid #d1d5db;z-index:9999}.categories-panel-container[_ngcontent-%COMP%]{padding:1rem}.category-card[_ngcontent-%COMP%]{border-radius:.75rem;transition:box-shadow .2s ease}.category-card[_ngcontent-%COMP%]:hover{box-shadow:0 0 .5rem #0000001a}.icon-wrapper[_ngcontent-%COMP%]{width:48px;height:48px;background-color:#fff3cd;border-radius:.5rem;display:flex;align-items:center;justify-content:center}.icon-wrapper[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;color:#0d6efd}.btn-add-cat[_ngcontent-%COMP%]{margin-left:10px;padding:.65rem 1.75rem;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.95rem;font-weight:600;transition:all .2s ease;display:flex;align-items:center;justify-content:center;gap:.5rem;box-shadow:0 2px 8px #3b82f640;letter-spacing:.3px}.btn-add-cat[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#2563eb,#1d4ed8);box-shadow:0 4px 12px #3b82f659;transform:translateY(-1px)}.btn-add-cat[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:0 2px 6px #3b82f64d}"]})};var de=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=h({type:n,selectors:[["app-categories"]],decls:4,vars:0,consts:[[1,"categories-container"]],template:function(t,i){t&1&&(g(0,"app-toggleable-sidebar")(1,"app-header"),o(2,"main",0),g(3,"app-categories-panel"),a())},dependencies:[ie,V,oe],styles:[".categories-container[_ngcontent-%COMP%]{margin-top:70px;margin-left:80px;padding:10px;min-height:calc(100vh - 70px);box-sizing:border-box;background-color:#f9fafb;display:flex;flex-direction:column}body[_ngcontent-%COMP%]{background-color:#f9fafb}@media (max-width: 768px){.categories-container[_ngcontent-%COMP%]{height:100%;margin-left:0;padding:8px;min-width:0;margin-top:60px}.category-card[_ngcontent-%COMP%]{margin:8px 0;padding:10px;font-size:1rem}.btn-add-cat[_ngcontent-%COMP%]{width:100%;display:block;margin-top:10px;font-size:.08rem;padding:.7rem 1rem}}@media (min-width: 769px) and (max-width: 1024px){.categories-container[_ngcontent-%COMP%]{margin-left:80px;height:100vh}}@media (max-width: 991px){.categories-container[_ngcontent-%COMP%]{padding:10px 8px;margin-left:0}.category-card[_ngcontent-%COMP%]{font-size:1.05rem;padding:12px}}@media (max-width: 768px){.categories-container[_ngcontent-%COMP%]{height:100%;margin-left:0;padding:8px;min-width:0}.category-card[_ngcontent-%COMP%]{margin:8px 0;padding:10px;font-size:1rem}.btn-add-cat[_ngcontent-%COMP%]{width:100%;display:block;margin-top:10px;font-size:1.08rem;padding:.7rem 1rem}}@media (max-width: 425px){.categories-container[_ngcontent-%COMP%]{padding:4px;margin-left:0}.category-card[_ngcontent-%COMP%]{font-size:.98rem;padding:8px;margin:6px 0}.btn-add-cat[_ngcontent-%COMP%]{width:100%;display:block;margin-top:10px;font-size:1.02rem;padding:.65rem .8rem}}@media (max-width: 320px){.categories-container[_ngcontent-%COMP%]{padding:2px;margin-left:0}.category-card[_ngcontent-%COMP%]{font-size:.92rem;padding:5px;margin:4px 0}.btn-add-cat[_ngcontent-%COMP%]{width:100%;display:block;margin-top:8px;font-size:.98rem;padding:.6rem}}"]})};export{de as Categories};
